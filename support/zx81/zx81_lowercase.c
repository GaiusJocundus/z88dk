/*
 *  ZX81 lowercase font utility
 *  it loads a lowercase font compatible with the Dk'Tronics
 *  lowercase font available in the 4K graphics ROM.
 *
 *  zcc +zx81 -create-app -pragma-define:ZX_CHAR_XLATE_MODE=3 dktronics.asm zx81_lowercase.c
 *
 *  Load the tool, select the desired font/configurationm
 *  quit the program and load a z88dk program built with -pragma-define:ZX_CHAR_XLATE_MODE=3.
 *  
 *  Setting ZX_CHAR_XLATE_MODE=3 will add the following startup code
 
 		ld a,(11905)   ; Dk'Tronics 4K ROM probe
		cp 32
		call z,11914   ; set lowercase font if the ROM is present

 *  If the ROM is not present, the text configuration will be left untouched, so this
 *  tool can be run just before loading a program built for the Dk'Tronics lowercase option
 */

#include <stdio.h>
#include <stdlib.h>
#include <string.h>


// Old English font sorted as an alternative
// to the Dk'Tronics lowercase set

char oldeng[] = {
 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 ,
 0x00 , 0x00 , 0x34 , 0x4C , 0x44 , 0x44 , 0x36 , 0x00 ,
 0x40 , 0x40 , 0x58 , 0x64 , 0x44 , 0x44 , 0x58 , 0x00 ,
 0x00 , 0x00 , 0x38 , 0x44 , 0x40 , 0x44 , 0x38 , 0x00 ,
 0x20 , 0x10 , 0x18 , 0x24 , 0x44 , 0x44 , 0x38 , 0x00 ,
 0x00 , 0x00 , 0x38 , 0x44 , 0x7C , 0x40 , 0x3C , 0x00 ,
 0x18 , 0x24 , 0x20 , 0x38 , 0x20 , 0x20 , 0x20 , 0x00 ,
 0x00 , 0x00 , 0x38 , 0x44 , 0x40 , 0x4C , 0x3C , 0x04 ,
 0x40 , 0x40 , 0x58 , 0x64 , 0x44 , 0x48 , 0x5C , 0x00 ,
 0x08 , 0x00 , 0x18 , 0x08 , 0x08 , 0x08 , 0x1C , 0x00 ,
 0x08 , 0x00 , 0x18 , 0x08 , 0x08 , 0x08 , 0x28 , 0x10 ,
 0x40 , 0x40 , 0x48 , 0x50 , 0x70 , 0x48 , 0x44 , 0x00 ,
 0x20 , 0x20 , 0x20 , 0x20 , 0x20 , 0x24 , 0x18 , 0x00 ,
 0x00 , 0x00 , 0x56 , 0x69 , 0x49 , 0x42 , 0x47 , 0x00 ,
 0x00 , 0x00 , 0x58 , 0x64 , 0x44 , 0x48 , 0x5C , 0x00 ,
 0x00 , 0x00 , 0x3C , 0x42 , 0x42 , 0x42 , 0x3C , 0x00 ,
 0x00 , 0x00 , 0x58 , 0x64 , 0x44 , 0x44 , 0x58 , 0x40 ,
 0x00 , 0x00 , 0x34 , 0x4C , 0x44 , 0x44 , 0x34 , 0x04 ,
 0x00 , 0x00 , 0x58 , 0x64 , 0x44 , 0x78 , 0x44 , 0x00 ,
 0x00 , 0x00 , 0x38 , 0x40 , 0x38 , 0x04 , 0x78 , 0x00 ,
 0x10 , 0x10 , 0x78 , 0x20 , 0x20 , 0x24 , 0x18 , 0x00 ,
 0x00 , 0x00 , 0x74 , 0x24 , 0x44 , 0x4C , 0x34 , 0x00 ,
 0x00 , 0x00 , 0x44 , 0x24 , 0x14 , 0x14 , 0x08 , 0x00 ,
 0x00 , 0x00 , 0x77 , 0x22 , 0x49 , 0x49 , 0x36 , 0x00 ,
 0x00 , 0x00 , 0x44 , 0x28 , 0x10 , 0x28 , 0x44 , 0x00 ,
 0x00 , 0x00 , 0x42 , 0x22 , 0x12 , 0x0C , 0x48 , 0x30 ,
 0x00 , 0x00 , 0x1E , 0x24 , 0x08 , 0x12 , 0x3C , 0x00 ,
 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x18 , 0x18 , 0x00 ,
 0x10 , 0x10 , 0x10 , 0x10 , 0x10 , 0x00 , 0x10 , 0x00 ,
 0x10 , 0x10 , 0x20 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 ,
 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x08 , 0x08 , 0x10 ,
 0xFF , 0xFF , 0xFF , 0xFF , 0x00 , 0x00 , 0x00 , 0x00 ,
 0x3C , 0x42 , 0x02 , 0x04 , 0x08 , 0x00 , 0x08 , 0x00 ,
 0x00 , 0x00 , 0x00 , 0x10 , 0x00 , 0x00 , 0x10 , 0x00 ,
 0x00 , 0x00 , 0x10 , 0x00 , 0x00 , 0x10 , 0x10 , 0x20 ,
 0x00 , 0x00 , 0x00 , 0x00 , 0x3E , 0x00 , 0x00 , 0x00 ,
 0x00 , 0x04 , 0x08 , 0x08 , 0x08 , 0x08 , 0x04 , 0x00 ,
 0x00 , 0x20 , 0x10 , 0x10 , 0x10 , 0x10 , 0x20 , 0x00 ,
 0x1E , 0x22 , 0x42 , 0x7E , 0x42 , 0x42 , 0x42 , 0x00 ,
 0x5C , 0x62 , 0x42 , 0x5C , 0x42 , 0x42 , 0x7C , 0x00 ,
 0x1C , 0x22 , 0x40 , 0x40 , 0x40 , 0x22 , 0x1C , 0x00 ,
 0x5C , 0x62 , 0x42 , 0x42 , 0x42 , 0x44 , 0x58 , 0x00 ,
 0x5E , 0x60 , 0x40 , 0x70 , 0x40 , 0x40 , 0x7E , 0x00 ,
 0x5E , 0x60 , 0x40 , 0x70 , 0x40 , 0x40 , 0x40 , 0x00 ,
 0x1C , 0x22 , 0x40 , 0x40 , 0x46 , 0x22 , 0x1E , 0x00 ,
 0x42 , 0x42 , 0x42 , 0x7E , 0x42 , 0x42 , 0x42 , 0x00 ,
 0x38 , 0x10 , 0x10 , 0x10 , 0x10 , 0x10 , 0x38 , 0x00 ,
 0x38 , 0x08 , 0x08 , 0x08 , 0x08 , 0x48 , 0x30 , 0x00 ,
 0x44 , 0x48 , 0x50 , 0x70 , 0x48 , 0x44 , 0x42 , 0x00 ,
 0x40 , 0x40 , 0x40 , 0x40 , 0x40 , 0x42 , 0x7C , 0x00 ,
 0x42 , 0x66 , 0x5A , 0x42 , 0x42 , 0x42 , 0x42 , 0x00 ,
 0x42 , 0x62 , 0x52 , 0x4A , 0x46 , 0x42 , 0x42 , 0x00 ,
 0x18 , 0x24 , 0x42 , 0x42 , 0x42 , 0x24 , 0x18 , 0x00 ,
 0x5C , 0x62 , 0x42 , 0x5C , 0x40 , 0x40 , 0x40 , 0x00 ,
 0x18 , 0x24 , 0x42 , 0x42 , 0x42 , 0x24 , 0x1A , 0x00 ,
 0x5C , 0x62 , 0x42 , 0x5C , 0x48 , 0x44 , 0x42 , 0x00 ,
 0x3C , 0x42 , 0x40 , 0x3C , 0x02 , 0x42 , 0x3C , 0x00 ,
 0x7C , 0x10 , 0x10 , 0x10 , 0x10 , 0x10 , 0x10 , 0x00 ,
 0x72 , 0x22 , 0x42 , 0x42 , 0x42 , 0x46 , 0x3A , 0x00 ,
 0x42 , 0x42 , 0x22 , 0x22 , 0x12 , 0x14 , 0x08 , 0x00 ,
 0x77 , 0x22 , 0x41 , 0x41 , 0x49 , 0x49 , 0x36 , 0x00 ,
 0x41 , 0x22 , 0x14 , 0x08 , 0x14 , 0x22 , 0x41 , 0x00 ,
 0x41 , 0x22 , 0x14 , 0x08 , 0x08 , 0x08 , 0x08 , 0x00 ,
 0x3F , 0x42 , 0x04 , 0x08 , 0x10 , 0x21 , 0x7E , 0x00  };


// Dk'Tronics style font
char dktronics[] = {
 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 ,
 0x00 , 0x00 , 0x3E , 0x42 , 0x42 , 0x46 , 0x3A , 0x00 ,
 0x00 , 0x40 , 0x40 , 0x5C , 0x62 , 0x42 , 0x7C , 0x00 ,
 0x00 , 0x00 , 0x3E , 0x40 , 0x40 , 0x40 , 0x3E , 0x00 ,
 0x00 , 0x02 , 0x02 , 0x3A , 0x46 , 0x42 , 0x3E , 0x00 ,
 0x00 , 0x00 , 0x3C , 0x42 , 0x7C , 0x40 , 0x3C , 0x00 ,
 0x00 , 0x0C , 0x12 , 0x10 , 0x7C , 0x10 , 0x10 , 0x00 ,
 0x00 , 0x00 , 0x3C , 0x42 , 0x42 , 0x3E , 0x02 , 0x3C ,
 0x00 , 0x40 , 0x40 , 0x58 , 0x64 , 0x44 , 0x44 , 0x00 ,
 0x00 , 0x10 , 0x00 , 0x10 , 0x30 , 0x10 , 0x38 , 0x00 ,
 0x00 , 0x08 , 0x00 , 0x08 , 0x18 , 0x08 , 0x08 , 0x30 ,
 0x00 , 0x20 , 0x24 , 0x28 , 0x30 , 0x28 , 0x24 , 0x00 ,
 0x00 , 0x30 , 0x10 , 0x10 , 0x10 , 0x10 , 0x38 , 0x00 ,
 0x00 , 0x00 , 0x54 , 0x6A , 0x4A , 0x4A , 0x4A , 0x00 ,
 0x00 , 0x00 , 0x58 , 0x64 , 0x44 , 0x44 , 0x44 , 0x00 ,
 0x00 , 0x00 , 0x38 , 0x44 , 0x44 , 0x44 , 0x38 , 0x00 ,
 0x00 , 0x00 , 0x58 , 0x64 , 0x44 , 0x78 , 0x40 , 0x40 ,
 0x00 , 0x00 , 0x34 , 0x4C , 0x44 , 0x3C , 0x04 , 0x04 ,
 0x00 , 0x00 , 0x2C , 0x30 , 0x20 , 0x20 , 0x20 , 0x00 ,
 0x00 , 0x00 , 0x3E , 0x40 , 0x3C , 0x02 , 0x7C , 0x00 ,
 0x00 , 0x10 , 0x10 , 0x7C , 0x10 , 0x12 , 0x0C , 0x00 ,
 0x00 , 0x00 , 0x44 , 0x44 , 0x44 , 0x44 , 0x3A , 0x00 ,
 0x00 , 0x00 , 0x44 , 0x44 , 0x28 , 0x28 , 0x10 , 0x00 ,
 0x00 , 0x00 , 0x82 , 0x92 , 0x92 , 0x92 , 0x6C , 0x00 ,
 0x00 , 0x00 , 0x44 , 0x28 , 0x10 , 0x28 , 0x44 , 0x00 ,
 0x00 , 0x00 , 0x42 , 0x42 , 0x42 , 0x3E , 0x02 , 0x7C ,
 0x00 , 0x00 , 0x7E , 0x04 , 0x08 , 0x10 , 0x7E , 0x00 ,
 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x18 , 0x18 , 0x00 ,
 0x00 , 0x08 , 0x08 , 0x08 , 0x08 , 0x00 , 0x08 , 0x00 ,
 0x00 , 0x08 , 0x08 , 0x10 , 0x00 , 0x00 , 0x00 , 0x00 ,
 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x10 , 0x10 , 0x20 ,
 0xFF , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 , 0x00 ,
 0x00 , 0x3C , 0x42 , 0x04 , 0x08 , 0x08 , 0x00 , 0x08 ,
 0x00 , 0x00 , 0x10 , 0x00 , 0x00 , 0x10 , 0x00 , 0x00 ,
 0x00 , 0x00 , 0x10 , 0x00 , 0x00 , 0x10 , 0x10 , 0x20 ,
 0x00 , 0x00 , 0x00 , 0x00 , 0x3C , 0x00 , 0x00 , 0x00 ,
 0x00 , 0x02 , 0x04 , 0x08 , 0x08 , 0x04 , 0x02 , 0x00 ,
 0x00 , 0x40 , 0x20 , 0x10 , 0x10 , 0x20 , 0x40 , 0x00 ,
 0x00 , 0x3C , 0x42 , 0x42 , 0x7E , 0x42 , 0x42 , 0x00 ,
 0x00 , 0x7C , 0x42 , 0x7C , 0x42 , 0x42 , 0x7C , 0x00 ,
 0x00 , 0x3C , 0x42 , 0x40 , 0x40 , 0x42 , 0x3C , 0x00 ,
 0x00 , 0x78 , 0x44 , 0x42 , 0x42 , 0x44 , 0x78 , 0x00 ,
 0x00 , 0x7E , 0x40 , 0x7C , 0x40 , 0x40 , 0x7E , 0x00 ,
 0x00 , 0x7E , 0x40 , 0x7C , 0x40 , 0x40 , 0x40 , 0x00 ,
 0x00 , 0x3C , 0x42 , 0x40 , 0x4E , 0x42 , 0x3C , 0x00 ,
 0x00 , 0x42 , 0x42 , 0x7E , 0x42 , 0x42 , 0x42 , 0x00 ,
 0x00 , 0x3E , 0x08 , 0x08 , 0x08 , 0x08 , 0x3E , 0x00 ,
 0x00 , 0x02 , 0x02 , 0x02 , 0x42 , 0x42 , 0x3C , 0x00 ,
 0x00 , 0x44 , 0x48 , 0x70 , 0x48 , 0x44 , 0x42 , 0x00 ,
 0x00 , 0x40 , 0x40 , 0x40 , 0x40 , 0x40 , 0x7E , 0x00 ,
 0x00 , 0x42 , 0x66 , 0x5A , 0x42 , 0x42 , 0x42 , 0x00 ,
 0x00 , 0x42 , 0x62 , 0x52 , 0x4A , 0x46 , 0x42 , 0x00 ,
 0x00 , 0x3C , 0x42 , 0x42 , 0x42 , 0x42 , 0x3C , 0x00 ,
 0x00 , 0x7C , 0x42 , 0x42 , 0x7C , 0x40 , 0x40 , 0x00 ,
 0x00 , 0x3C , 0x42 , 0x42 , 0x52 , 0x4A , 0x3C , 0x00 ,
 0x00 , 0x7C , 0x42 , 0x42 , 0x7C , 0x44 , 0x42 , 0x00 ,
 0x00 , 0x3C , 0x40 , 0x3C , 0x02 , 0x42 , 0x3C , 0x00 ,
 0x00 , 0xFE , 0x10 , 0x10 , 0x10 , 0x10 , 0x10 , 0x00 ,
 0x00 , 0x42 , 0x42 , 0x42 , 0x42 , 0x42 , 0x3C , 0x00 ,
 0x00 , 0x42 , 0x42 , 0x42 , 0x42 , 0x24 , 0x18 , 0x00 ,
 0x00 , 0x42 , 0x42 , 0x42 , 0x42 , 0x5A , 0x24 , 0x00 ,
 0x00 , 0x42 , 0x24 , 0x18 , 0x18 , 0x24 , 0x42 , 0x00 ,
 0x00 , 0x82 , 0x44 , 0x28 , 0x10 , 0x10 , 0x10 , 0x00 ,
 0x00 , 0x7E , 0x04 , 0x08 , 0x10 , 0x20 , 0x7E , 0x00  };


void loadfont(char font[])
{
	/* Load user defined graphics onto ZX81 set */
	/* Quicksilva position */
	memcpy(0x8400, font, 1024);
	/* ROM position */
	memcpy(0x1e00, font, 1024);
	/* Others */
	memcpy(0x2000, font, 1024);
	memcpy(0x8e00, font, 1024);
	memcpy(0x9e00, font, 1024);
	memcpy(0x2e00, font, 1024);
	/* dk'tronics (quick board test: PEEK 11905 must give 32)*/
	memcpy(0x3000, font, 1024);
	memcpy(0x3200, font, 1024);
}


void main()
{
	printf("\nPRESS NUMBER KEYS TO SELECT THE\nFONT HARDWARE TYPE\n\nPRESS Q TO EXIT\n\n");
	printf("\nPRESS O FOR OLDENG FONT\n\nD FOR DK TRONICS STYLE\n\n");
	printf("\nThe Quick Brown Fox Jumps\n To The GrapeVine");

	loadfont(dktronics);

while (1) {
	switch(fgetc_cons())
	{
		case '0':
			#asm
			ld	a,$1e
			ld	i,a
			#endasm
			break;
		case '1':
			#asm
			ld	a,$2e
			ld	i,a
			#endasm
			break;
		case '2':
			#asm
			ld	a,$84
			ld	i,a
			#endasm
			break;
		case '3':
			#asm
			ld	a,$8e
			ld	i,a
			#endasm
			break;
		case '4':
			#asm
			ld	a,$9e
			ld	i,a
			#endasm
			break;
		case '5':
			#asm
			ld	a,$30
			ld	i,a
			#endasm
			break;
		case '6':
			#asm
			ld	a,$32
			ld	i,a
			#endasm
			break;
		case '7':
			#asm
			ld	a,$20
			ld	i,a
			#endasm
			break;

		case 'Q':
		  exit(0);
			break;

		case 'O':
		  loadfont(oldeng);
			break;

		case 'D':
		  loadfont(dktronics);
			break;
	}
}}

